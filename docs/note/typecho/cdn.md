# 又拍云

## 前言

众所周知，因为又拍云有又拍云联盟的计划，每月都可白嫖一点的CDN流量和存储空间。以此就可以为你的Typecho站点添加CDN，以提高访问速度。

但问题还是有很大的，比如说缓存问题。

多数站长开启又拍云CDN缓存设置，会发现有一些问题不知道如何解决：包括但不限于登录后台无限刷新，退出后台账号无限刷新，文章无法评论或显示评论失败，评论无法及时显示等等问题。

在此我写了这篇文章来教大家设置又拍云的缓存，以避免以上问题

## 开始

### 又拍云缓存控制

> **什么是网页缓存：**
>
> 浏览程序也会在您的硬盘中保存网页的缓存，用来保存一些不用每次都从新加载的东西。
>
> **缓存的优点：**
>
> 可以提高网页加载速度，过滤掉不用重复加载的东西，从而提高用户体验。
>
> **缓存的缺点：**
>
> 如果缓存文件过多，过大的话会影响我们电脑的运行速度，所以要定时清理缓存

#### 设置又拍云缓存策略

##### 缓存策略

> 1.为加快网站的访问速度，我们需要缓存一些静态文件(你可以通过F12查看网页缓存的文件)
>
> 2.对于不常刷新的静态文件，缓存时间可以设置长一点，需要及时刷新的静态文件，缓存时间可以设置短一点，酌情设置
>
> 3.首页缓存与您的首页文章有关，请安装您的文章更新速度，适当选择！

**位置**在`又拍云控制台>CDN>配置>缓存控制>缓存配置>管理`

下面我给出我的**缓存策略**

```
#首页
/
#字体文件
/*.(tiff,svg,woff,ttf,woff2,eot)
#其他文件
/*.(css,js,map,txt,doc,xml,log,bat,cmd)
#图像文件
/*.(jpg,jpeg,png,bmp,gif,ico,webp)
#音视频文件
/*.(mp3,mp4,flv,wma,wmv,ogg,avi)
```

[![缓存规则](https://pic.rmb.bdstatic.com/bjh/33647e6501c5d00fbe858efbce23891d.png)](https://pic.rmb.bdstatic.com/bjh/33647e6501c5d00fbe858efbce23891d.png)

[缓存规则](https://pic.rmb.bdstatic.com/bjh/33647e6501c5d00fbe858efbce23891d.png)



##### 不缓存规则

> 1.为保证**后台**可以正常访问（不出现**无限刷新**），您需要将**后台目录路径**添加至**不缓存规则**
>
> 2.为保证您可以在后台成功**退出**账号，您需要将**后台退出路径**添加至**不缓存规则**
>
> 3.为保证您及您好友在发布评论时**不失败**和文章**及时显示评论**，您需要将**文章路径**添加至**不缓存规则**
>
> 4.为保证您网站的正常运行，您需要将网站**动态文件**添加至**不缓存规则**

下面我给出我的**不缓存规则**

```
#后台路径
/admin/*
#后台退出路径
/index.php/action/*
#动态文件
/*.(php,jsp,asp,aspx)
#文章路径
/archives/*.html
```

[![不缓存规则](https://pic.rmb.bdstatic.com/bjh/484482563e8794a2acdbb0a78fc5b810.png)](https://pic.rmb.bdstatic.com/bjh/484482563e8794a2acdbb0a78fc5b810.png)

[不缓存规则](https://pic.rmb.bdstatic.com/bjh/484482563e8794a2acdbb0a78fc5b810.png)



#### 参数跟随

位置在`又拍云控制台>CDN>配置>缓存控制>参数跟随`

**参数跟随**请选择**全程跟随**

[![全程跟随](https://pic.rmb.bdstatic.com/bjh/f1c5cf1c95bd7bff745b6d7c588a4f1f.png)](https://pic.rmb.bdstatic.com/bjh/f1c5cf1c95bd7bff745b6d7c588a4f1f.png)

[全程跟随](https://pic.rmb.bdstatic.com/bjh/f1c5cf1c95bd7bff745b6d7c588a4f1f.png)



## 结语

完结撒花，本人纯属小白，文笔有限，若有不清楚之处还望海涵。如有错误请留言

合作共赢，共同进步

# 腾讯云

## 开始

### 绑定域名

打开腾讯云 `控制台>内容分发网络>域名管理>添加域名`

添加域名，信息如下图所示

[![请输入图片描述](https://image.raycns.com/raycns.com-20210703151111.jpg)](https://image.raycns.com/raycns.com-20210703151111.jpg)

### 缓存设置

> **小知识：**
>
> **什么是网页缓存：**
>
> 浏览程序也会在您的硬盘中保存网页的缓存，用来保存一些不用每次都从新加载的东西。
>
> **缓存的优点：**
>
> 可以提高网页加载速度，过滤掉不用重复加载的东西，从而提高用户体验。
>
> **缓存的缺点：**
>
> 如果缓存文件过多，过大的话会影响我们电脑的运行速度，所以要定时清理缓存

#### 缓存原则

1. 为加快网站访问速度，避免重复加载，我们需要将网站静态文件添加至至缓存策略
2. 为避免网站后台等问题的发生，我们需要将网站后台路径添加至不缓存策略
3. 为避免网站文章评论出现问题，我们需要将文章页面添加至不缓存类别（当然你也可以直接将html后缀文件添加至不缓存策略）
4. 等等问题

添加站点后在CDN**控制台点击域名>缓存配置>节点缓存过期配置**，添加如下缓存规则

| 类型           | 内容                                   | 缓存行为 |
| :------------- | :------------------------------------- | :------- |
| **文件后缀**   | **tiff;svg;woff;ttf;woff2;eot**        | 缓存30天 |
| **文件后缀**   | **jpg;jpeg;png;bmp;gif;ico;webp**      | 缓存30天 |
| **文件后缀**   | **css;js;map;txt;doc;xml;log;bat;cmd** | 缓存30天 |
| **全部文件**   | **全部文件**                           | 缓存1天  |
| **首页**       | **/**                                  | 缓存1天  |
| **文件后缀**   | **php;jsp;asp;aspx;html**              | 不缓存   |
| **文件目录**   | **/admin**                             | 不缓存   |
| **文件目录**   | **/index.php/action**                  | 不缓存   |
| **全路径文件** | **/archives/\*.html**                  | 不缓存   |

*PS：注意缓存行为与优先级，优先级下列大于上列*

## 后语

大概这样就可以了。后台可登录，评论可显示

